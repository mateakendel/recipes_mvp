<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Recipes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

</head>

<body>

<div class="page">

    <header class="page-header">
        <h1>All published recipes</h1>
        <a class="back-link" href="/home">⬅ Back to my home</a>
    </header>


    <section class="search-box">
        <h3>Search recipes</h3>

        <div class="search-grid">
            <input id="q" placeholder="Search by ingredient or text">

            <select id="category">
                <option value="">All categories</option>
                <option value="Predjelo">Predjelo</option>
                <option value="Glavno jelo">Glavno jelo</option>
                <option value="Desert">Desert</option>
                <option value="Piće">Piće</option>
                <option value="Salata">Salata</option>
            </select>

            <button onclick="search()">Search</button>
            <button class="secondary" onclick="loadAllRecipes()">Reset</button>
        </div>
    </section>


    <section class="results">
        <div id="recipes">
            <em>Loading recipes...</em>
        </div>
    </section>

</div>

<script>
function renderRecipes(data) {
    const container = document.getElementById("recipes");
    container.innerHTML = "";

    if (data.length === 0) {
        container.innerHTML = "<em>No recipes found.</em>";
        return;
    }

    data.forEach(r => {
        const div = document.createElement("div");
        div.className = "recipe-card";
        div.innerHTML = `
            <a href="/recipe/${r._id}" class="recipe-title">
                ${r.title}
            </a>
            <div class="recipe-meta">
                <span class="category">${r.category}</span>
                <span class="author">by ${r.author}</span>
            </div>
        `;
        container.appendChild(div);
    });
}


function loadAllRecipes() {
    fetch("/recipes")
        .then(res => res.json())
        .then(renderRecipes)
        .catch(err => {
            document.getElementById("recipes").innerHTML =
                "<em>Error loading recipes.</em>";
            console.error(err);
        });
}


function search() {
    const q = document.getElementById("q").value.trim();
    const category = document.getElementById("category").value;

    let url = `/recipes/search?q=${encodeURIComponent(q)}`;
    if (category) {
        url += `&category=${encodeURIComponent(category)}`;
    }

    fetch(url)
        .then(res => res.json())
        .then(renderRecipes)
        .catch(err => {
            document.getElementById("recipes").innerHTML =
                "<em>Error searching recipes.</em>";
            console.error(err);
        });
}

loadAllRecipes();
</script>

</body>
</html>
